# v2.3.0 Custom Dashboard — Design Document

## Problem

The app now presents 11+ charts, multiple tables, and stat cards across 4 tabs. Users — particularly business owners and accountants — can feel overwhelmed. They often want to compare specific data points across strategies but have to mentally cross-reference between tabs. There's no way to focus on just the metrics that matter to a specific user's situation.

## Solution

A **Custom Dashboard** tab — a "comparison workbench" where users drag widgets from a visual shelf onto a 2-column grid. Each widget has its own strategy selector, so users can place the same chart type side-by-side with different strategies to spot differences instantly.

## Core Interactions

### Widget Shelf (top)
- Horizontal scrollable row of ~13 widget thumbnail cards
- Each card: icon/preview, widget name, drag grip indicator
- Stays visible as user scrolls through their built dashboard
- Contains every visualization available in the app (charts, tables, stat cards)

### Drop Zone Grid (below)
- Fixed 2-column layout, widgets snap left-to-right, top-to-bottom
- Can drop between existing widgets to insert at specific position
- Empty state: dashed border + "Drag widgets here to build your comparison view"
- Hint text: "Tip: Place the same widget twice with different strategies to compare side by side"

### Per-Widget Controls
- **Strategy selector pill** (top-right): compact dropdown with 3 strategies + color dots
- **Drag handle** (header bar): grab to reorder within the grid
- **Remove button** (top-left): X to remove, widget animates out, grid reflows
- Same widget type can be placed multiple times with different strategies

### Widget Reordering
- Grab any placed widget by its header → drag to new position → others shift
- Same drag mechanic as shelf-to-grid, just within the grid

## Widget Catalog

### Charts (9)
1. **Total Tax Comparison** (bar) — from ComparisonCharts
2. **Corporate Balance Over Time** (line) — from ComparisonCharts
3. **Cumulative Tax Paid** (line) — from ComparisonCharts
4. **Tax Breakdown** (stacked bar) — from DetailedCharts
5. **Compensation Mix** (stacked bar) — from DetailedCharts
6. **RRSP Room** (grouped bar) — from DetailedCharts
7. **Effective Tax Rate** (line) — from DetailedCharts
8. **IPP Contributions** (line) — from DetailedCharts (conditional: IPP enabled)
9. **Compensation by Year** (stacked bar) — from Chart component

### Tables (3)
10. **After-Tax Wealth Scenarios** — from AfterTaxWealthTable
11. **Year-by-Year Action Plan** — from ActionPlanTable
12. **Full Yearly Projection** — from YearlyProjection (condensed)

### Stat Cards (1)
13. **Key Metrics Summary** — Total comp, avg income, final balance, effective rates

## Persistence

- Layout saved to `localStorage` key `ccpc-dashboard-v1`
- Format: `Array<{ id: string, widgetType: string, strategyId: string }>`
- Auto-loads on tab revisit
- "Reset Dashboard" button in top-right to clear back to empty state
- One layout only (no save/load multiple — YAGNI)

## Mobile Behavior

- Below 768px: shelf becomes vertical scrollable list
- Grid collapses to 1 column
- Drag-and-drop works via touch (dnd-kit handles natively)
- Strategy selector unchanged

## Technical Architecture

### New Files
- `src/components/tabs/DashboardTab.tsx` — Main tab, drag context, grid state
- `src/components/dashboard/WidgetShelf.tsx` — Horizontal shelf of draggable cards
- `src/components/dashboard/WidgetCard.tsx` — Widget wrapper (controls + renders chart/table)
- `src/components/dashboard/widgetRegistry.ts` — Maps widget IDs to components/labels/icons
- `src/lib/__tests__/dashboard.test.ts` — Registry, persistence, state tests

### Modified Files
- `src/components/tabs/TabNavigation.tsx` — Add 'dashboard' to TabId, 5th tab
- `src/components/Summary.tsx` — Import DashboardTab, pass comparison data

### New Dependency
- `@dnd-kit/core` + `@dnd-kit/sortable` + `@dnd-kit/utilities`

### Data Flow
```
Summary.tsx
  └─ comparisonResult (all 3 strategies + yearlyData)
     └─ DashboardTab.tsx
        ├─ widgets state: Array<{ id, widgetType, strategyId }>
        ├─ synced to localStorage
        └─ WidgetCard.tsx (per widget)
           ├─ strategy selector → picks data slice
           └─ renders existing chart/table component
```

### Key Principle
No new chart or table components. Every dashboard widget reuses existing visualization components. We're giving users control over *which* ones to show and for *which* strategy.

## Design Decisions & Rationale

| Decision | Rationale |
|----------|-----------|
| Fixed 2-column (no resize) | Prevents broken comparisons, removes layout decisions, forces side-by-side pattern |
| Empty by default (no presets) | Other tabs already curate views; dashboard is for "I know what I want" |
| Per-widget strategy selector | The real power — same chart type, different strategies, side by side |
| @dnd-kit over alternatives | Modern, maintained, accessible, keyboard nav, touch support |
| localStorage (not URL/share) | Dashboard is personal preference, not shareable analysis |
| No multiple saved layouts | YAGNI — one persistent layout is sufficient |
